import{$ as o}from"./index.820bcd3d.js";const g="https://api.coze.cn",w="7593155326733434915",h="sat_TKKXdcbl480LV9AhNjwrsoPloL0otWQ4WzrWj6TzUkNwbOt7Pa1jg9gNjWWc29sK";function i(r){o("#status").text(r)}async function f(r){const s=`${g}/v1/workflow/run`,t=await fetch(s,{method:"POST",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({workflow_id:w,parameters:r,is_async:!1})}),u=await t.text();let e;try{e=JSON.parse(u)}catch{e={raw:u}}if(!t.ok)throw new Error(`Coze API HTTP ${t.status}: ${JSON.stringify(e)}`);return e}o(async function(){try{i("\u5C31\u7EEA"),o("#authorizationInput").val(localStorage.getItem("authorization")||""),o("#vipCodeInput").val(localStorage.getItem("vip_code")||""),o("#authorizationInput").on("input",()=>{const t=String(o("#authorizationInput").val()||"").trim();t&&localStorage.setItem("authorization",t)}),o("#vipCodeInput").on("input",()=>{const t=String(o("#vipCodeInput").val()||"").trim();t&&localStorage.setItem("vip_code",t)});let r="";async function s(t){if(!t)throw new Error("\u6CA1\u6709\u53EF\u590D\u5236\u7684 debug_url");try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(t);return}}catch{}const u=document.createElement("textarea");u.value=t,u.setAttribute("readonly","true"),u.style.position="fixed",u.style.left="-9999px",u.style.top="-9999px",document.body.appendChild(u),u.focus(),u.select();const e=document.execCommand("copy");document.body.removeChild(u),!e&&window.prompt("\u590D\u5236\u4E0B\u9762\u7684\u94FE\u63A5\uFF1A",t)}o("#copyDebugUrl").on("click",async()=>{try{await s(r);const t=o("#copyDebugUrl"),u=t.attr("title")||"";t.attr("title","\u5DF2\u590D\u5236"),setTimeout(()=>t.attr("title",u),900)}catch(t){alert((t==null?void 0:t.message)||String(t))}}),o("#collectNow").on("click",async function(){const t=o("#collectNow");try{i("\u91C7\u96C6\u4E2D\u2026"),t.prop("disabled",!0),r="",o("#copyDebugUrl").hide();const u=String(o("#detailUrl").val()||"").trim();if(!u)throw new Error("\u4F60\u8FD8\u6CA1\u6709\u586B\u5199[\u7B14\u8BB0\u94FE\u63A5]");const e="http://xhslink.com/",d="https://www.xiaohongshu.com/explore/";if(!u.includes(e)&&!u.includes(d))throw new Error("\u7B14\u8BB0\u94FE\u63A5\u4E0D\u6B63\u786E");const c=String(o("#authorizationInput").val()||"").trim(),l=String(o("#vipCodeInput").val()||"").trim();if(c&&localStorage.setItem("authorization",c),l&&localStorage.setItem("vip_code",l),!c)throw new Error('\u8BF7\u586B\u5199\u6B63\u786E\u7684"\u6388\u6743\u7801"');if(!l)throw new Error('\u8BF7\u586B\u5199\u6B63\u786E\u7684"\u4F1A\u5458\u7801"');const a=await f({authorization:c,vip_code:l,detail_url:u}),p=String((a==null?void 0:a.debug_url)||"").trim();r=p,p&&o("#copyDebugUrl").show();try{const n=typeof(a==null?void 0:a.data)=="string"?JSON.parse(a.data):a==null?void 0:a.data;if(String(n==null?void 0:n.err)==="500")throw new Error("\u91C7\u96C6\u5931\u8D25\uFF0C\u8BF7\u786E\u8BA4\u60A8\u7684\u300C\u4F1A\u5458\u7801\u300D\u662F\u5426\u6B63\u786E")}catch(n){if((n==null?void 0:n.message)==="\u91C7\u96C6\u5931\u8D25\uFF0C\u8BF7\u786E\u8BA4\u60A8\u7684\u300C\u4F1A\u5458\u7801\u300D\u662F\u5426\u6B63\u786E")throw n}alert("\u2705\u5DF2\u91C7\u96C6\u5B8C\u6210"),i("\u5B8C\u6210")}catch(u){console.error(u),alert((u==null?void 0:u.message)||String(u)),i("\u5931\u8D25")}finally{t.prop("disabled",!1)}})}catch(r){console.error(r),alert((r==null?void 0:r.message)||String(r)),i("\u521D\u59CB\u5316\u5931\u8D25")}});
